parameters:
  - name: seriviceConnectionName
    type: string
  - name: subscriptionId
    type: string
  - name: systemName
    type: string
    default: "tomatoe"
  - name: environmentName
    type: string
  - name: artifactName
    type: string
    default: "arm-templates"
  - name: location
    type: string
  - name: usWebAppId
    type: string
  - name: weWebAppId
    type: string
  - name: asiWebAppId
    type: string           

steps:
  - task: DownloadPipelineArtifact@0
    displayName: "Download Artifact: ${{ parameters.artifactName }}"
    inputs:
      artifactName: "${{ parameters.artifactName }}"
      targetPath: $(System.ArtifactsDirectory)/${{ parameters.artifactName }}

  - task: AzureResourceManagerTemplateDeployment@3
    displayName: Deploy Main Template
    inputs:
      deploymentScope: 'Subscription'
      azureResourceManagerConnection: "${{ parameters.seriviceConnectionName }}"
      location: ${{ parameters.location }}
      subscriptionId: "${{ parameters.subscriptionId }}"
      templateLocation: 'Linked artifact'
      csmFile: "$(System.ArtifactsDirectory)/${{ parameters.artifactName }}/trafficmgr.bicep"      
      overrideParameters: -environmentName ${{parameters.environmentName}} -usWebAppId ${{parameters.usWebAppId}} -weWebAppId ${{parameters.weWebAppId}} -asiWebAppId ${{parameters.asiWebAppId}} -systemName ${{parameters.systemName}}
      deploymentMode: 'Incremental' 
 

  - task: Bash@3
    displayName: Output in other file
    inputs:
      targetType: inline
      script: |
        echo "el asiWebAppIdId es = ${{parameters.asiWebAppId}}"   
