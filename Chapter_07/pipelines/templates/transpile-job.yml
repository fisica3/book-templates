parameters:
  - name: artifactName
    type: string
    default: "arm-templates"

steps:
  - bash: az bicep build --file ./Chapter_07/deployment/main.bicep
    displayName: "Transpile Main Bicep"

  - bash: az bicep build --file ./Chapter_07/deployment/trafficmgr.bicep
    displayName: "Transpile Traffic Manager Bicep"

  - bash: ls ./Chapter_07/deployment
    displayName: "Lista componentes 07"  

  - task: CopyFiles@2
    displayName: "Copy JSON files to: $(Build.ArtifactStagingDirectory)/${{parameters.artifactName}}"
    inputs:
      SourceFolder: './Chapter_07/deployment'
      Contents: '**/.json'
      TargetFolder: '$(Build.ArtifactStagingDirectory)'

  - publish: '$(Build.ArtifactStagingDirectory)'
    displayName: 'Publish JSON'
    artifact: drop      
    
  - download: current
    artifact: drop
    patterns: '**/*.json'
    
  #- bash: ls "$(Build.ArtifactStagingDirectory)/${{parameters.artifactName}}"
  #  displayName: "Lista componentes Artifact"         

  #- task: PublishPipelineArtifact@1
  #  displayName: "Publish Pipeline Artifact"
  #  inputs:
  #    targetPath: "$(Build.ArtifactStagingDirectory)/${{parameters.artifactName}}"
  #    artifact: "${{parameters.artifactName}}"
